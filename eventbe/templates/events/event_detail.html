{% extends 'layouts/layout.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="container my-5">
  <div class="row p-4 pb-0 pe-lg-0 pt-lg-5 align-items-center rounded-3 border shadow-lg">
    <div class="col-lg-7 p-3 p-lg-5 pt-lg-3">
      <div class="d-flex align-items-center">
        <!--================ Title =================-->
        <h1 class="display-4 fw-bold lh-1 mb-3">{{ event.title }}</h1>
        <!--================ To Update =================-->
        {% if event.organizer.id == user.id %}
          <a href="{% url 'events:update' id=event.id %}">
            <img src="{% static 'img/gear.png' %}" width="50" height="50" style="opacity: 0.5;">
          </a>
        {% endif %}
      </div>
      <!--================ Tags =================-->
      <p>{{ event.tags.all|join:'   ' }}</p>
      <h3 class="display-9">{{ event.date }}</h3>
      <!--================ Description =================-->
      <p class="lead">
        <br>
        {{ event.description|striptags }}
      </p>
      <!--================ Map =================-->

      {% if field.is_offline %}

      <script src="https://api-maps.yandex.ru/2.1/?apikey=bb74b0bc-212f-441f-84ea-455e27c089a2&lang=ru_RU"
        type="text/javascript"></script>
      <script src="{% static 'js/ya_map_create_event.js' %}" type="text/javascript"></script>

      <div id="map" style="width: 40rem; height: 30rem;"></div>
      {% translate '' %}
      <table class="table" id="location_table">
        <tbody>
          <tr>
            <td><label class="font-weight-bold" for="{{  form.location_x.id_for_label }}">
                {% translate 'Longitude' %}</label></td>
            <td>
              <label class="font-weight-bold" for="{{  form.location_y.id_for_label }}">
                {% translate 'Latitude' %}</label>
            </td>
          </tr>
          <tr>
            <td>
              {{ form.location_x }}
            </td>
            <td>
              {{ form.location_y }}
            </td>
          </tr>
        </tbody>
      </table>

      {% endif %}

    </div>
    <!--================ Thumbnail =================-->
    <div class="col-lg-4 offset-lg-1 p-0 mb-4 overflow-hidden">
      <img class="rounded-3" src="{% if event.event_image.get_image_300x300.url %} {{event.event_image.get_image_300x300.url}} {% else %} {% static 'img/users/avatars-default.jpg' %} {% endif %}" alt="..." />
    </div>
    <!--================ Comment List =================-->
    <hr class="hr">
    <div id="comments">
      {% for comment in comments %}
      <div class="card mb-4">
        <div class="card-body">
          <p>{{ comment.message }}</p>
          <div class="d-flex justify-content-between">
            <div class="d-flex flex-row align-items-center">
              {% if comment.author.avatar.image %}
                <img src="{{ comment.author.avatar.get_image_300x300.url }}" class="rounded-circle" width="40" height="40">
              {% endif %}
              <p class="small mb-0 ms-2">{{ comment.author.username }}</p>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
      <p class="text-center mb-3">{% translate "No comments here yet... Be the first one to comment!" %}</p>
      {% endfor %}
    </div>
    <!--================ Comment Form =================-->
    {% if user.is_authenticated %}
    <form class="basic-form" method="post" enctype="multipart/form-data">
      {% include 'include/form.html' %}
      <div class="row justify-content-center text-center">
        <div class="col-md-12">
          <input type="submit" class="btn btn-outline-success btn-send" value="{% translate 'Post' %}">
        </div>
      </div>
    </form>
    {% else %}
      <hr class="hr">
      <p class="text-center text-muted"><i>{% translate "You can post comments only if you are authenticated" %}</i></p>
    {% endif %}
    <!--================ Delete Event Button =================-->
    {% if user.id == event.organizer.id %}
      <form method="post">
        {% csrf_token %}
        <div class="col-md-12 text-center mt-5 mb-1">
          <hr class="hr">
          <input type="submit" name="delete_event" class="btn btn-outline-danger" value="{% translate 'Delete Event' %}">
        </div>
      </form>
    {% endif %}
  </div>
</div>
{% endblock %}